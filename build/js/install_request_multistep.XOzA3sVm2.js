/*! For license information please see install_request_multistep.XOzA3sVm2.js.LICENSE.txt */
!function(){const e=PRHelper.getHook(),t=PRHelper.getHTML(),n=PRHelper.getType(),s=PRHelper.getTool(),i=PRHelper.getForm(),a=PRHelper.getRequest(),r=PRHelper.getSetting(),o=t.getElement(".pr-multistep-wrap"),c=t.getAttribute(o,"id"),l=window.PR_MULTISTEPS[c];t.hide(t.getParent(t.getElement(".submit-action",o)));let m=0,p="",g=!1;function _(){return t.is("#accept_terms_of_use",":checked")}function u(e){switch(e){case"requirements":t.setElementActivity(t.getElement("#step_content_requirements .next-action"),t.is("#confirmation",":checked"),!1);break;case"consent":t.setElementActivity(t.getElement("#step_content_consent .next-action"),_(),!1);break;case"thank_you":object.stop(!1)}}l.stop(!1),e.on("focus",(()=>{g||t.setElementActivity("button#check_serial",!0)}),'.pr--field[name="serial"]'),e.on("click",(e=>{const i=t.getTarget(e,"button"),o=t.getParent(i,'[data-name="serial_check"]');if(t.isElement(o)){const e=t.serializeForm(o,(e=>e.trim()));if(l.showMessage(""),n.isEmpty(e.serial))l.showMessage(r.getOption("message.empty_serial",""));else if(7!==e.serial.length)l.showMessage(r.getOption("message.serial_not_valid",""));else{const n=t.getElement(".serial-information",o),c=t.getElement(".pr-spinner",o);g=!0,l.stop(!1),t.spinner(c,!0),a.ajax(r.getOption("ajax.check_serial")).onSuccess((s=>{p=e.serial,m=parseInt(s.installation),t.fadeIn(n,{start:()=>{t.replace(s.html,n,!1)}}),t.setValue('.pr--field[name="serial"]',""),t.setElementActivity(i,!1),l.resume()})).onError((e=>{l.showMessage(s.error2string(e)),t.empty(n),m=0,l.stop(!1)})).onFinally((()=>{g=!1,t.spinner(c,!1)})).addNonce().send(e)}}}),"button#check_serial"),e.on("change",(e=>{u("consent")}),"#accept_terms_of_use"),e.on("change",(e=>{u("requirements")}),"#confirmation"),e.addFilter(`multistep_${c}_can_goto_next_step`,(async(e,c)=>{if(!0===e){let l=!1;switch(c.getCurrentStepName()){case"serial_check":(m<0||n.isEmpty(m))&&(l="check_serial_first");break;case"requirements":t.is('[data-name="requirements"] #confirmation',":checked")||(l="check_confirmation");break;case"setup_information":const c=i.getInvalidFields('.pr-multistep-step-content[data-name="setup_information"]');n.isEmpty(c)||(n.each(c,(e=>{i.showFieldMessage(e.field,r.getOption(`field.invalid.${e.type}`,""),!0,!0)})),l="fill_required_fields");break;case"consent":if(_()){let n=t.serializeForm(o);n.serial=p,n.installation_id=m,await a.ajax(r.getOption("ajax.submit_installation")).addNonce().onError((t=>{e=s.error2string(t)})).send(n)}else l="accept_terms_of_use_first"}l&&(e=r.getOption(`message.${l}`,!1))}return e})),e.addAction(`multistep_${c}_step_changed`,(e=>{u(e.getCurrentStepName())}))}();