(()=>{"use strict";var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var i in a)t.o(a,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:a[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=jQuery;var a=t.n(e);a()(document).ready((function(){let t=!0,e=a()(".url-preview"),i=a()("form.multi-step-from"),n=a()("#url_preview_action"),r=a()('[name="order_payment_type"]'),l=a()('[name="order_request_domain"]'),o=a()(".action-url-preview-container"),s=i.closest(".product-type-variable").length>0;if(PMPRUtil.isEmpty(r)||r.on("change",(async t=>{let e=!1,n=a()(t.currentTarget).val(),r=a()(".service-details"),l=r.find("tbody"),o=r.find(".pr-spinner"),d=i.data("multistep");d.stop(),o.addClass("show");let c=PMPRUtil.getSettingByPath("backlink_coupon.type"),p=parseInt(PMPRUtil.getSettingByPath("backlink_coupon.min")),u=parseInt(PMPRUtil.getSettingByPath("backlink_coupon.value"));if(s){let t=r.find(".price-cell");switch(n){case"order_payment_type_backlink":let i=0,n=0,o=parseInt(t.data("value"));e||(t.removeClass("h6"),isNaN(p)||p<o?("percent"===c?(i=u*o/100,n=o-i):(i=u,n=o-i,n<=0&&(n=o,i=0)),await g({total:n,discount:i},(({total:t,discount:e})=>{let r=l.find(".price-row td:first").attr("colspan")||0;l.append(w(a()('<tr class="discount-row text-danger"/>'),i,e,r,"discount-cell",PMPRUtil.getSettingByPath("translation.discount_title"))),l.append(w(a()('<tr class="total-row h6"/>'),n,t,r,"total-cell",PMPRUtil.getSettingByPath("translation.total_title")))}))):e="coupon_minimum");break;case"order_payment_type_normal":t.addClass("h6"),r.find(".discount-row, .total-row").remove()}}else n;e?d.showMessage(PMPRUtil.getSettingByPath(`errors.${e}`),"warning"):(d.messageContainer.html(""),d.resume()),o.removeClass("show")})),PMPRUtil.isEmpty(l)||(l.on("change",(t=>{let e=a()(t.currentTarget),i=a()("#order_request_new_domain"),n=a()("#order_request_prv_domains");switch(e.val()){case"new_domain":n.parent().hide(),i.parent().show();break;case"prv_domains":i.parent().hide(),n.parent().show()}})),l.first().trigger("change")),PMPRUtil.isEmpty(n)||(n.on("click",(async r=>{r.preventDefault();let l=a()(r.currentTarget),s=l.find(".pr-spinner"),d="",c=a()("[name=order_request_domain]:checked").val(),p=a()(`[name="order_request_${c}"]`);if(c&&p.length>0&&p.length>0){let t=p.val();switch(c){case"new_domain":d=t;break;case"prv_domains":d=p.find(`option[value="${t}"]`).data("value")}}if(d=u(d),d){let a=i.data("multistep");if(a&&!PMPRUtil.isEmpty(e)){s.addClass("show"),v(n),a.stop();let i=PMPRUtil.getSettingByPath("ajax.get_url_screenshot");PMPRRequest.post(i,{url:`https://${d}`,width:800}).addNonce().setSuccess((t=>{o.hide(),e.prepend(`<img src="${t}" height="500" width="1142" class="rounded w-100 h-100" alt="screenshot">`)})).setError((t=>{o.hide(),e.prepend(PMPRUtil.getSettingByPath("error_icon")),a.showMessage(PMPRUtil.getSettingByPath("errors.screenshot_fetch_error"),"info")})).setComplete((()=>{a.resume(),s.removeClass("show"),v(n,!1),t=!0})).send()}}})),a()("input.domain-input").on("change input",(t=>{let e=a()(t.currentTarget),i=u(e.val());i&&e.val(i)})),a()(document).on("change input",'.domain-input, [name="order_request_domain"]',(()=>{e.find("img").remove(),e.find(".pr-icon").remove(),o.show(),f()?v(n):v(n,!1)}))),s){PMPRTrigger.addAction("collection_field_added",(t=>{if(!t.is(".blocked")){let e=t.closest("#variations").data("not-addable");PMPRUtil.isEmpty(e)||a().each(e,((e,i)=>{a().each(i,((e,a)=>{let i=t.find(`select[data-attribute_name="${e}"]`);PMPRUtil.isEmpty(i)||i.find(`option[value="${a}"]`).remove()}))})),d(t)}}));let t=a()(".variations select:not(.collection-field)"),e=!PMPRUtil.isEmpty(t);function d(t){let e=t.parent(),i=e.data("unique-attrs");if(!PMPRUtil.isEmpty(i)&&e.children().length>2){let n=a()(PMPRUtil.get(e.find(".form-row:not(.blocked)"),0));PMPRUtil.isEmpty(n)||a().each(i,((e,i)=>{let r=n.find(`select[data-attribute_name="${i}"]`),l=t.find(`select[data-attribute_name="${i}"]`);if(!PMPRUtil.isEmpties([r,l])){let t=r.val();PMPRUtil.isEmpty(t)||(l.find("option").removeClass("d-none"),l.val(t).trigger("change"),l.find(`option:not([value="${t}"])`).addClass("d-none")),r.is(".event-added")||(r.on("change",(function(){let t=a()(this),e=t.closest("#variations").find(".form-row:not(.blocked)");for(let i=1;i<e.length;i++){let n=a()(e[i]),r=P(t);if(n.find("select").val("").trigger("change"),!PMPRUtil.isEmpty(n)){let t=n.find(`select[data-attribute_name="${r}"]`);PMPRUtil.isEmpty(t)||t.val(a()(this).val()).trigger("change")}d(n)}})),r.addClass("event-added"))}}))}}function c(n=null,r=null){let l=null;if(e&&(l=t),null!==r){let t=r.find("select");l=PMPRUtil.isEmpty(l)?t:a().merge(l,t)}let o=function(t){let e={};return a().each(t,(function(t,i){let n=a()(i),r=P(n);e[r]=n.val()||""})),e}(l);a().each(l,(function(t,e){!function(t,e){let n=":gt(0)",r=a()("<select/>"),l=t.data("show_option_none"),o=P(t),s=t.val()||"",d=0,c=!0;if(!t.data("attribute_html")){let e=t.clone();e.find("option").removeAttr("attached").prop("disabled",!1).prop("selected",!1),t.data("attribute_options",e.find("option"+n).get()),t.data("attribute_html",e.html())}r.html(t.data("attribute_html"));let u=a().extend(!0,{},e);u[o]="";let m=function(t,e){let a=[];for(let i=0;i<t.length;i++){let n=t[i];p(n.attributes,e)&&a.push(n)}return a}(i.data("product_variations"),u);for(let t in m)if(void 0!==m[t]){let e=m[t].attributes;for(let i in e)if(e.hasOwnProperty(i)){let n=e[i],l="";if(i===o)if(m[t].variation_is_active&&(l="enabled"),n){n=a()("<div/>").html(n).text();let t=r.find("option");if(t.length)for(let e=0,i=t.length;e<i;e++){let i=a()(t[e]);if(n===i.val()){i.addClass("attached "+l);break}}}else r.find("option:gt(0)").addClass("attached "+l)}}d=r.find("option.attached").length,s&&(c=!1,0!==d&&r.find("option.attached.enabled").each((function(){let t=a()(this).val();if(s===t)return c=!0,!1})));d>0&&s&&c&&"no"===l&&(r.find("option:first").remove(),n="");r.find(`option${n}:not(.attached)`).remove(),t.html(r.html()),t.find(`option${n}:not(.enabled)`).prop("disabled",!0),s?c?t.val(s):t.val("").trigger("change"):t.val("")}(a()(e),o)})),null!==n&&n.trigger("woocommerce_update_collection_variations_values")}function p(t,e){let a=!0;for(let i in t)if(t.hasOwnProperty(i)){let n=t[i],r=e[i];void 0!==n&&void 0!==r&&0!==n.length&&0!==r.length&&n!==r&&(a=!1)}return a}e&&t.on("change",(function(){!function(t=null){let e=a()(".form-collection .form-row:not(.blocked)");e.length>0?e.each((function(e,i){c(t,a()(i))})):c(t)}(a()(this))})),a()(document).on("change",".form-collection select",(function(){let t=a()(this),e=t.closest(".form-row");c(t,e)}))}function u(t){let e=!1,a="https://";if(PMPRUtil.isUrl(a+t)){let i=t.match(/www\.(.*)$/);i&&void 0!==i[1]&&(t=i[1]),e=new URL(a+t).host}return e}function m(){let t=!1,e=a()('[name="order_request_domain"]:checked');if(!PMPRUtil.isEmpty(e)){let i=e.val(),n=a()(`[name="order_request_${i}"]`);PMPRUtil.isEmpty(n)||(t=n.val())}return t}function h(){let t={},e=a()(".form-collection").repeaterVal().variations,i=a()(".variations select:not(.collection-field)");if(e){i.each(((e,i)=>{let n=a()(i);t[P(n)]=n.val()}));for(let a in e)e.hasOwnProperty(a)&&(e[a]={...e[a],...t})}return e}function P(t){return t.data("attribute_name")||t.attr("name")}function f(){let t=!1,e=a()('[name="order_request_domain"]:checked');if(PMPRUtil.isEmpty(e))t="select_request_domain";else{let i=e.val(),n=a()(`[name="order_request_${i}"]`);if(PMPRUtil.isEmpty(n))t="request_domain_not_valid";else switch(i){case"new_domain":u(n.val())||(t="domain_is_not_valid");break;case"prv_domains":n.val()||(t="select_domain")}}return t}function _(t){let e=!1,n=i.data("product_variations");return a().each(n,((i,n)=>{let r=!0;if(a().each(t,((t,e)=>{PMPRUtil.isEmpty(n.attributes[t])||(r=r&&n.attributes[t]===e)})),r)return e=n,!0})),e}async function g(t,e){let a=PMPRUtil.getSettingByPath("ajax.get_price");await PMPRRequest.post(a,{price:t}).addNonce().setSuccess(e).send()}function v(t,e=!0){let a="disabled";e?t.addClass(a):t.removeClass(a),t.prop(a,e)}function y(t,e,a,i=""){return t.append(`<td data-value="${a}" class="${i}">${e}</td>`),t}function w(t,e,a,i,n,r=null){return r?(t.append(`<td colspan="${i-1}"/>`),t.append(`<td>${r}</td>`)):t.append(`<td colspan="${i}"/>`),y(t,a,e,n)}PMPRTrigger.addAction("collection_fields_reseted",((t,e)=>{e.find("select").each(((t,e)=>{!function(t){let e=t.data("attribute_html");e&&t.html(e)}(a()(e))}))})),PMPRTrigger.addFilter("can_go_to_next_step",(async(e,n,r)=>{let l=!1,o=e;if(!0===e){switch(r){case 1:PMPRUtil.isEmpty(a()("[name=order_request_type]:checked"))&&(l="check_order_type");break;case 2:l=f(),l||t||(l="submit_url_preview");break;case 3:if(s){let t=a()(".step-3 .variations select");if(PMPRUtil.isEmpty(t))l="add_service_details";else if(t.removeClass("border-danger"),t.each(((t,e)=>{let i=a()(e);if(PMPRUtil.isEmpty(i.val()))return i.addClass("border-danger"),l="fields_require",!1})),!l){let t=h();if(t){let e=PMPRUtil.getSettingByPath("ajax.check_variations");if(await PMPRRequest.post(e,{domain:m(),product:i.data("product_id"),variations:t}).setError((t=>{let e=t.data;e?(PMPRUtil.isEmpty(e.steps)||n.invalid(e.steps),l=!0,o=e.message):l="check_variation_error"})).addNonce().send(),!l){let e=0,i=1,n=a()(".service-details tbody");n.html("");for(let r in t)if(t.hasOwnProperty(r)){let l=PMPRUtil.getSettingByPath("attributes_columns"),o=_(t[r]);if(!PMPRUtil.isEmpty(o)&&!PMPRUtil.isEmpty(l)){let t=o.display_price;e+=t,await g(t,(e=>{let s=a()("<tr/>");s.append(a()(`<td>${PMPRUtil.number2persian(parseInt(r)+1)}</td>`)),a().each(l,((t,e)=>{let n=!1;o.attribute_names.hasOwnProperty(e)?n=o.attribute_names[e]:o.attributes.hasOwnProperty(e)&&(n=o.attributes[e]),n&&(s.append(a()(`<td>${n}</td>`)),0==r&&i++)})),n.append(y(s,e,t))}))}}await g(e,(t=>{n.append(w(a()('<tr class="price-row"/>'),e,t,i,"price-cell h6"))})),a()('[name="order_payment_type"]:checked').trigger("change")}}else l="add_service_details"}}}l?(n.messageContainer.attr("data-type","warning"),o=PMPRUtil.getSettingByPath(`errors.${l}`,o)):o=!0}return o}),10),PMPRTrigger.addAction(`multistep_form_${i.attr("id")}_submitted`,(async(t,e)=>{let n=a()(t.currentTarget);e.waiting(!0,n);let r={data:PMPRUtil.serializeForm(i),product:i.data("product_id")},l=PMPRUtil.getSettingByPath("ajax.add_to_cart");s&&(r.variations=function(){let t=h(),e=[];for(let a in t)if(t.hasOwnProperty(a)){let i=_(t[a]);i&&e.push(i)}return e}()),r={...r,...PMPRUtil.serializeForm(i.find("input:hidden"))},PMPRRequest.post(l,r).addNonce().setSuccess((t=>{let e=t.go_to;e?window.location.href=e:window.location.reload()})).setError((t=>{let a=t.data;a&&(PMPRUtil.isEmpty(a.steps)||e.invalid(a.steps),e.showMessage(a.message,a.type))})).setComplete((()=>{e.waiting(!1,n)})).send()}))}))})();