/*! For license information please see purchase_multistep.BxQMPGpCD.js.LICENSE.txt */
!function(){const e=PRHelper.getHook(),t=PRHelper.getHTML(),n=PRHelper.getType(),r=PRHelper.getTool(),a=PRHelper.getFormat(),s=PRHelper.getRequest(),o=PRHelper.getSetting(),i=t.getElement(".pr-multistep-wrap"),_=t.getAttribute(i,"id"),c=t.getElement('[name="order_request_domain"]');function l(){let e=!1,r=t.getValue('[name="order_request_domain"]');if(n.isEmpty(r))e="select_request_domain";else{const s=t.getValue("input#domain");if(n.isEmpty(s)){const n=t.getElement(`[name="order_request_${r}"]`);if(t.isElement(n))switch(r){case"new_domain":(function(e){let t=!1,n="https://";if(a.isURL(n+e)){let r=e.match(/www\.(.*)$/);r&&void 0!==r[1]&&(e=r[1]),t=new URL(n+e).host}return t})(t.getValue(n))||(e="domain_is_not_valid");break;case"prev_domains":t.getValue(n)||(e="select_domain")}else e="request_domain_not_valid"}}return e}async function m(e){"consent"===e&&t.setElementActivity(t.getElement("#step_content_consent .next-action"),t.is("#accept_terms_of_use",":checked"),!1)}t.isElement(c)&&e.on("change",(e=>{const n=t.getTarget(e),r=t.getElement("#order_request_new_domain"),a=t.getElement("#order_request_new_domain_title"),s=t.getElement("#order_request_prev_domains");switch(t.getValue(n)){case"new_domain":t.hide(t.getParent(s)),t.show(t.getParent(r)),t.show(t.getParent(a));break;case"prev_domains":t.hide(t.getParent(a)),t.hide(t.getParent(r)),t.show(t.getParent(s))}}),c),e.addFilter(`multistep_${_}_can_goto_next_step`,(async(e,a)=>{if(!0===e){let _=!1;switch(a.getCurrentStepName()){case"choice_domain":if(_=l(),!_){const e=t.getElement("[name=order_request_type]",a.getElement());n.isEmpty(t.getValue(e))&&(_="check_order_type")}break;case"consent":const c=t.getElements(".detail-value","#step_content_thank_you.pr-multistep-step-content");if(t.isList(c)){let _=t.serializeForm(i);_={..._,...a.getData()},await s.ajax(o.getOption("ajax.get_order_details")).addNonce().onSuccess((e=>{n.each(c,(n=>{t.replace(e[t.getData(n,"key")],n,!1)}))})).onError((t=>{e=r.error2string(t)})).send(_)}}_&&(e=o.getOption(`errors.${_}`,!1))}return e})),e.addAction(`multistep_${_}_step_changed`,(e=>{m(e.getCurrentStepName())})),e.on("change",(e=>{m("consent")}),"#accept_terms_of_use")}();