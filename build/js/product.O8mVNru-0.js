(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=jQuery;var a=e.n(t);a()(document).ready((function(){let e=!0,t=a()(".url-preview"),r=a()("form.multi-step-from"),i=a()("#url_preview_action"),n=a()('[name="order_payment_type"]'),s=a()('[name="order_request_domain"]'),o=a()(".action-url-preview-container"),l=r.closest(".product-type-variable").length>0;function d(e){let t=!1,a="https://";if(PMPRUtil.isUrl(a+e)){let r=e.match(/www\.(.*)$/);r&&void 0!==r[1]&&(e=r[1]),t=new URL(a+e).host}return t}function c(){let e=p(),t=[];for(let a in e)if(e.hasOwnProperty(a)){let r=P(e[a]);r&&t.push(r)}return t}function p(){let e={},t=a()(".form-collection").repeaterVal().variations,r=a()(".variations select:not(.collection-field)");if(t){r.each(((t,r)=>{let i=a()(r);var n;e[(n=i,n.data("attribute_name")||n.attr("name"))]=i.val()}));for(let a in t)t.hasOwnProperty(a)&&(t[a]={...t[a],...e})}return t}function u(){let e=!1,t=a()('[name="order_request_domain"]:checked');if(PMPRUtil.isEmpty(t))e="select_request_domain";else{let r=t.val(),i=a()(`[name="order_request_${r}"]`);if(PMPRUtil.isEmpty(i))e="request_domain_not_valid";else switch(r){case"new_domain":d(i.val())||(e="domain_is_not_valid");break;case"prv_domains":i.val()||(e="select_domain")}}return e}function P(e){let t=!1,i=r.data("product_variations");return a().each(i,((r,i)=>{if(i.display_price){let r=!0;if(a().each(e,((e,t)=>{PMPRUtil.isEmpty(i.attributes[e])||(r=r&&i.attributes[e]===t)})),r)return t=i,!0}})),t}async function _(e,t){let a=await PMPRUtil.addNonceToData({price:e}),r=PMPRUtil.getSettingByPath("ajax.get_price");await PMPRRequest.post(r,a).setSuccess(t).send()}function m(e,t=!0){let a="disabled";t?e.addClass(a):e.removeClass(a),e.prop(a,t)}function h(e,t,a,r=""){return e.append(`<td data-value="${a}" class="${r}">${t}</td>`),e}function g(e,t,a,r,i,n=null){return n?(e.append(`<td colspan="${r-1}"/>`),e.append(`<td>${n}</td>`)):e.append(`<td colspan="${r}"/>`),h(e,a,t,i)}PMPRUtil.isEmpty(i)||(i.on("click",(async n=>{n.preventDefault();let s=a()(n.currentTarget),l=s.find(".pr-spinner"),c="",p=a()("[name=order_request_domain]:checked").val(),u=a()(`[name="order_request_${p}"]`);if(p&&u.length>0&&u.length>0){let e=u.val();switch(p){case"new_domain":c=e;break;case"prv_domains":c=u.find(`option[value="${e}"]`).data("value")}}if(c=d(c),c){let a=r.data("multistep");if(a&&!PMPRUtil.isEmpty(t)){l.addClass("show"),m(i),a.stop();let r=await PMPRUtil.addNonceToData({url:`https://${c}`,width:800}),n=PMPRUtil.getSettingByPath("ajax.get_url_screenshot");PMPRRequest.post(n,r).setSuccess((e=>{o.hide(),t.prepend(`<img src="${e}" height="500" width="1142" class="rounded w-100 h-100" alt="screenshot">`)})).setError((e=>{o.hide(),t.prepend(PMPRUtil.getSettingByPath("error_icon")),a.showMessage(PMPRUtil.getSettingByPath("errors.screenshot_fetch_error"),"info")})).setComplete((()=>{a.resume(),l.removeClass("show"),m(i,!1),e=!0})).send()}}})),a()("input.domain-input").on("change input",(e=>{let t=a()(e.currentTarget),r=d(t.val());r&&t.val(r)})),a()(document).on("change input",'.domain-input, [name="order_request_domain"]',(()=>{t.find("img").remove(),t.find(".pr-icon").remove(),o.show(),u()?m(i):m(i,!1)}))),PMPRUtil.isEmpty(s)||(s.on("change",(e=>{let t=a()(e.currentTarget),r=a()("#order_request_new_domain"),i=a()("#order_request_prv_domains");switch(t.val()){case"new_domain":i.parent().hide(),r.parent().show();break;case"prv_domains":r.parent().hide(),i.parent().show()}})),s.first().trigger("change")),PMPRUtil.isEmpty(n)||n.on("change",(async e=>{let t=a()(e.currentTarget),i=!1,n=t.val(),s=a()(".service-details"),o=s.find("tbody"),d=s.find(".pr-spinner"),p=r.data("multistep");p.stop(),d.addClass("show");let u=PMPRUtil.getSettingByPath("backlink_coupon.type"),P=parseInt(PMPRUtil.getSettingByPath("backlink_coupon.min")),m=parseInt(PMPRUtil.getSettingByPath("backlink_coupon.value"));if(l){let e=s.find(".price-cell");switch(n){case"order_payment_type_backlink":let t=0,r=0,n=c(),l=parseInt(e.data("value"));a().each(n,((e,t)=>{if(!t.is_use_coupon)return i="can_not_use_coupon",!1})),i||(e.removeClass("h6"),isNaN(P)||P<l?("percent"===u?(t=m*l/100,r=l-t):(t=m,r=l-t,r<=0&&(r=l,t=0)),await _({total:r,discount:t},(({total:e,discount:i})=>{let n=o.find(".price-row td:first").attr("colspan")||0;o.append(g(a()('<tr class="discount-row text-danger"/>'),t,i,n,"discount-cell",PMPRUtil.getSettingByPath("translation.discount_title"))),o.append(g(a()('<tr class="total-row h6"/>'),r,e,n,"total-cell",PMPRUtil.getSettingByPath("translation.total_title")))}))):i="coupon_minimum");break;case"order_payment_type_normal":e.addClass("h6"),s.find(".discount-row, .total-row").remove()}}else n;i?p.showMessage(PMPRUtil.getSettingByPath(`errors.${i}`),"warning"):(p.messageContainer.html(""),p.resume()),d.removeClass("show")})),PMPRTrigger.addAction("collection_fields_reseted",((e,t)=>{t.find("select").each(((e,t)=>{!function(e){let t=e.data("attribute_html");t&&e.html(t)}(a()(t))}))})),PMPRTrigger.addFilter("can_go_to_next_step",(async(t,r,i)=>{let n=!1,s=t;if(!0===t){switch(i){case 1:PMPRUtil.isEmpty(a()("[name=order_request_type]:checked"))&&(n="check_order_type");break;case 2:n=u(),n||e||(n="submit_url_preview");break;case 3:if(l){let e=a()(".step-3 .variations select");if(PMPRUtil.isEmpty(e))n="add_service_details";else if(e.removeClass("border-danger"),e.each(((e,t)=>{let r=a()(t);if(PMPRUtil.isEmpty(r.val()))return r.addClass("border-danger"),n="fields_require",!1})),!n){let e=p(),t=a()(".service-details tbody");if(e){t.html("");let r=0,i=1;for(let n in e)if(e.hasOwnProperty(n)){let s=PMPRUtil.getSettingByPath("attributes_columns"),o=P(e[n]);if(!PMPRUtil.isEmpty(o)&&!PMPRUtil.isEmpty(s)){let e=o.display_price;r+=e,await _(e,(r=>{let l=a()("<tr/>");l.append(a()(`<td>${PMPRUtil.number2persian(parseInt(n)+1)}</td>`)),a().each(s,((e,t)=>{let r=!1;o.attribute_names.hasOwnProperty(t)?r=o.attribute_names[t]:o.attributes.hasOwnProperty(t)&&(r=o.attributes[t]),r&&(l.append(a()(`<td>${r}</td>`)),0==n&&i++)})),t.append(h(l,r,e))}))}}await _(r,(e=>{t.append(g(a()('<tr class="price-row"/>'),r,e,i,"price-cell h6"))})),a()('[name="order_payment_type"]:checked').trigger("change")}}}}n?(r.messageContainer.attr("data-type","warning"),s=PMPRUtil.getSettingByPath(`errors.${n}`)):s=!0}return s}),10),PMPRTrigger.addAction(`multistep_form_${r.attr("id")}_submitted`,(async(e,t)=>{let i=a()(e.currentTarget);t.waiting(!0,i);let n=await PMPRUtil.addNonceToData({data:PMPRUtil.serializeForm(r),variations:c()}),s=PMPRUtil.getSettingByPath("ajax.add_to_cart");PMPRRequest.post(s,n).setSuccess((e=>{let t=e.go_to;t?window.location.href=t:window.location.reload()})).setError((e=>{let a=e.data;a&&(PMPRUtil.isEmpty(a.steps)||t.invalid(a.steps),t.showMessage(a.message,a.type))})).setComplete((()=>{t.waiting(!1,i)})).send()}))}))})();